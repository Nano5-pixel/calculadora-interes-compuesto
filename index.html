<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de inter√©s compuesto</title>
    
    <meta name="description" content="Calculadora profesional de inter√©s compuesto. Analiza tu rentabilidad neta real descontando el IRPF de Espa√±a y la inflaci√≥n proyectada.">
    <meta name="author" content="Nano">

    <script defer src="/_vercel/insights/script.js"></script>

    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2344/2344132.png" type="image/png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@900&display=swap');
        :root { --neon: #00ffcc; --blue: #0099ff; --pink: #ff00ff; --orange: #ff9900; --bg: #0f172a; --card: #1e293b; --red: #ff4444; --yellow: #ffcc00; --green: #00ff88; }
        
        body { background-color: var(--bg); color: #f8fafc; font-family: 'JetBrains Mono', monospace; display: flex; flex-direction: column; align-items: center; padding: 10px; min-height: 100vh; margin: 0; }
        .container { background-color: var(--card); padding: 20px; border-radius: 20px; box-shadow: 0 0 40px rgba(0, 255, 204, 0.2); border: 1px solid #334155; max-width: 1200px; width: 100%; box-sizing: border-box; }
        
        h1 { font-family: 'Orbitron', sans-serif; color: var(--neon); text-align: center; text-transform: uppercase; margin-bottom: 5px; font-size: 1.5rem; text-shadow: 0 0 10px rgba(0, 255, 204, 0.4); }
        .subtitle { text-align: center; color: var(--blue); text-transform: uppercase; letter-spacing: 4px; font-size: 0.7rem; font-weight: 700; margin-bottom: 25px; }
        
        @media (min-width: 768px) { h1 { font-size: 2.2rem; } .subtitle { font-size: 0.8rem; letter-spacing: 8px; } body { padding: 20px; } }

        .mode-selector select { width: 100%; padding: 12px; background: #161e2d; color: var(--neon); border: 2px solid var(--neon); border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; margin-bottom: 20px; font-family: inherit; }
        
        .grid-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 20px; }
        label { font-size: 0.6rem; color: #94a3b8; text-transform: uppercase; font-weight: bold; display: block; margin-bottom: 4px; }
        input, select { width: 100%; padding: 10px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 8px; font-family: inherit; box-sizing: border-box; }
        input:focus, select:focus { outline: none; border-color: var(--neon); box-shadow: 0 0 10px rgba(0, 255, 204, 0.2); }

        .tax-toggle { display: flex; align-items: center; background: rgba(255, 153, 0, 0.1); padding: 10px; border-radius: 10px; border: 1px solid var(--orange); grid-column: 1 / -1; cursor: pointer; }
        .tax-toggle input { width: auto; margin-right: 12px; accent-color: var(--orange); }
        .tax-toggle label { margin-bottom: 0; cursor: pointer; display: flex; align-items: center; }
        .flag-icon { font-family: sans-serif; margin-right: 8px; font-size: 1.2rem; }

        .btn-group { display: flex; flex-direction: column; gap: 10px; }
        button { width: 100%; padding: 15px; border-radius: 10px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; font-weight: 900; transition: 0.3s; font-family: inherit; }
        .btn-main { background: linear-gradient(135deg, var(--neon), var(--blue)); border: none; color: #0f172a; }
        .btn-main:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 255, 204, 0.3); }
        .btn-reset { background: transparent; border: 1px solid #334155; color: #94a3b8; font-size: 0.7rem; }
        .btn-reset:hover { border-color: var(--pink); color: var(--pink); background: rgba(255, 0, 255, 0.05); }

        .main-layout { display: flex; flex-direction: column; gap: 20px; margin-top: 25px; }
        @media (min-width: 1024px) { .main-layout { display: grid; grid-template-columns: 350px 1fr; } }

        .result-box { padding: 15px; background: #0b1120; border-radius: 15px; border-left: 5px solid var(--neon); margin-bottom: 10px; }
        .res-label { font-size: 0.65rem; color: #94a3b8; text-transform: uppercase; }
        .res-val { font-size: 1.4rem; color: var(--neon); font-weight: bold; margin-top: 5px; display: block; word-break: break-all; }
        
        .chart-container { background: #0b1120; padding: 10px; border-radius: 15px; height: 300px; border: 1px solid #334155; position: relative; }
        @media (min-width: 768px) { .chart-container { height: 450px; padding: 20px; } }

        .table-wrapper { overflow-x: auto; border: 1px solid #334155; border-radius: 10px; margin-top: 15px; background: #0b1120; scrollbar-width: thin; scrollbar-color: var(--neon) #0b1120; }
        table { width: 100%; border-collapse: collapse; font-size: 0.7rem; min-width: 400px; }
        th { background: #1e293b; color: var(--neon); padding: 10px; text-transform: uppercase; letter-spacing: 1px; }
        td { padding: 12px 8px; border-bottom: 1px solid #334155; text-align: center; color: #cbd5e1; }
        tr:hover td { background: rgba(0, 255, 204, 0.05); }

        .user-guide { margin-top: 30px; padding: 25px; background: #161e2d; border-radius: 15px; border: 1px dashed #334155; }
        .guide-h { color: var(--neon); font-family: 'Orbitron', sans-serif; font-size: 1rem; margin-bottom: 20px; text-transform: uppercase; border-bottom: 1px solid #334155; padding-bottom: 10px; letter-spacing: 1px; }
        .guide-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; font-size: 0.75rem; color: #94a3b8; }
        .guide-item b { color: var(--blue); display: block; margin-bottom: 8px; font-size: 0.85rem; letter-spacing: 0.5px; }
        .guide-list { list-style: none; padding: 0; margin: 0; }
        .guide-list li { margin-bottom: 8px; display: flex; align-items: baseline; }
        .guide-list li b { color: var(--neon); margin-right: 8px; min-width: 60px; display: inline-block; }

        .credits { margin-top: 30px; text-align: center; font-size: 0.7rem; color: #475569; letter-spacing: 3px; text-transform: uppercase; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Calculadora de inter√©s compuesto</h1>
        <p class="subtitle">Nano Edition</p>

        <div class="mode-selector">
            <select id="modo" onchange="cambiarModo()">
                <option value="ahorro">¬øCu√°nto dinero tendr√© en X a√±os?</option>
                <option value="tiempo">¬øCu√°nto tardar√© en alcanzar mi objetivo?</option>
                <option value="cuota">¬øCu√°nto necesito ahorrar cada mes?</option>
                <option value="interes">¬øQu√© inter√©s necesito para mi objetivo?</option>
            </select>
        </div>
        
        <div class="grid-inputs">
            <div id="div-objetivo" style="display:none;"><label>Objetivo (‚Ç¨)</label><input type="number" id="objetivo" value="100000" min="0"></div>
            <div><label>Cap. Inicial (‚Ç¨)</label><input type="number" id="capital" value="5000" min="0"></div>
            <div id="div-aporte"><label>Aporte Mes (‚Ç¨)</label><input type="number" id="aporte" value="500" min="0"></div>
            <div id="div-interes"><label>Inter√©s Anual (%)</label><input type="number" id="interes" value="10" min="0" step="0.1"></div>
            <div id="div-anios"><label>A√±os de Inversi√≥n</label><input type="number" id="anios" value="20" min="1" step="1"></div>
            <div><label>Inflaci√≥n Estimada (%)</label><input type="number" id="inflacion" value="2" min="0" step="0.1"></div>
            <div>
                <label>Momento del Aporte</label>
                <select id="momento">
                    <option value="fin">Al final del mes</option>
                    <option value="inicio">Al inicio del mes</option>
                </select>
            </div>
            <div class="tax-toggle">
                <input type="checkbox" id="tax-on" checked>
                <label for="tax-on" style="color:var(--orange); font-weight:bold; font-size:0.75rem;">
                    <span class="flag-icon">üá™üá∏</span> APLICAR IRPF ESPA√ëA
                </label>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn-main" onclick="ejecutarCalculo()">Analizar Plan</button>
            <button class="btn-reset" onclick="reiniciarDatos()">üóëÔ∏è Limpiar Datos</button>
        </div>

        <div class="main-layout">
            <div class="data-side">
                <div class="result-box">
                    <span class="res-label">RESULTADO BRUTO ESTIMADO:</span>
                    <span class="res-val" id="res-nom">0,00 ‚Ç¨</span>
                </div>
                <div class="result-box" style="border-color: var(--pink); background: rgba(255, 0, 255, 0.05);">
                    <span class="res-label" style="color: var(--pink);">PODER DE COMPRA REAL (NETO):</span>
                    <span class="res-val" id="res-real" style="color: var(--pink);">0,00 ‚Ç¨</span>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead><tr><th>A√±o</th><th>Aportado</th><th>Balance</th><th>Real (Neto)</th></tr></thead>
                        <tbody id="cuerpo-tabla"></tbody>
                    </table>
                </div>
            </div>
            <div class="chart-side">
                <div class="chart-container"><canvas id="miGrafico"></canvas></div>
            </div>
        </div>

        <div class="user-guide">
            <div class="guide-h">Gu√≠a del Inversor Profesional</div>
            <div class="guide-grid">
                <div class="guide-item">
                    <b>Inflaci√≥n y Hacienda</b>
                    Calculamos tu poder adquisitivo real descontando la inflaci√≥n proyectada y aplicando los tramos oficiales progresivos (19% - 28%) del **IRPF de Espa√±a** sobre los beneficios.
                </div>
                <div class="guide-item">
                    <b>Modos de C√°lculo</b>
                    <ul class="guide-list">
                        <li><b>Ahorro:</b> Capital final acumulado.</li>
                        <li><b>Tiempo:</b> A√±os para lograr objetivo.</li>
                        <li><b>Cuota:</b> Ahorro mensual necesario.</li>
                        <li><b>Inter√©s:</b> Rentabilidad requerida.</li>
                    </ul>
                </div>
                <div class="guide-item">
                    <b>Sem√°foro de Riesgo (Estimado)</b>
                    <span style="color: var(--green); font-weight:bold;">‚óè Verde: &lt; 5%</span> (Conservador)<br>
                    <span style="color: var(--yellow); font-weight:bold;">‚óè Amarillo: 5-9%</span> (Moderado)<br>
                    <span style="color: var(--red); font-weight:bold;">‚óè Rojo: &gt; 9%</span> (Agresivo)
                </div>
            </div>
        </div>

        <div class="credits">Made by <b>Nano</b> | 2026 Edition</div>
    </div>

    <script>
        let grafico;
        
        function cambiarModo() {
            const m = document.getElementById('modo').value;
            const campos = {
                'ahorro': ['div-capital', 'div-aporte', 'div-interes', 'div-anios'],
                'tiempo': ['div-objetivo', 'div-capital', 'div-aporte', 'div-interes'],
                'cuota': ['div-objetivo', 'div-capital', 'div-interes', 'div-anios'],
                'interes': ['div-objetivo', 'div-capital', 'div-aporte', 'div-anios']
            };
            
            // Reseteamos visibilidad
            ['div-objetivo', 'div-capital', 'div-aporte', 'div-interes', 'div-anios'].forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            
            // Activamos los campos del modo actual
            campos[m].forEach(id => {
                document.getElementById(id).style.display = 'block';
            });
        }

        function reiniciarDatos() {
            document.getElementById('capital').value = 0;
            document.getElementById('aporte').value = 0;
            document.getElementById('interes').value = 0;
            document.getElementById('anios').value = 1;
            document.getElementById('objetivo').value = 0;
            ejecutarCalculo();
        }

        function calcularIRPF(beneficio) {
            if (beneficio <= 0) return 0;
            if (beneficio <= 6000) return beneficio * 0.19;
            if (beneficio <= 50000) return (6000 * 0.19) + (beneficio - 6000) * 0.21;
            if (beneficio <= 200000) return (6000 * 0.19) + (44000 * 0.21) + (beneficio - 50000) * 0.23;
            return (6000 * 0.19) + (44000 * 0.21) + (150000 * 0.23) + (beneficio - 200000) * 0.27;
        }

        function fv(P, PMT, r, n, momento) {
            if (r === 0) return P + (PMT * n);
            const comp = Math.pow(1 + r, n);
            return (momento === 'inicio') ? P * comp + PMT * (1 + r) * (comp - 1) / r : P * comp + PMT * (comp - 1) / r;
        }

        function ejecutarCalculo() {
            const modo = document.getElementById('modo').value, useTax = document.getElementById('tax-on').checked;
            const cap = parseFloat(document.getElementById('capital').value) || 0, obj = parseFloat(document.getElementById('objetivo').value) || 0;
            const infla = parseFloat(document.getElementById('inflacion').value) / 100, mom = document.getElementById('momento').value;
            let ap = parseFloat(document.getElementById('aporte').value) || 0, intA = parseFloat(document.getElementById('interes').value) / 100 || 0, anMax = parseInt(document.getElementById('anios').value) || 1;

            // Validaciones b√°sicas
            if (anMax < 1) anMax = 1; intA = Math.max(0, intA); infla = Math.max(0, infla);

            if (modo === 'interes') {
                let low = 0, high = 20; // Aumentado rango de b√∫squeda
                for(let i=0; i<100; i++){ let mid = (low + high) / 2; if (fv(cap, ap, mid/12, anMax*12, mom) < obj) low = mid; else high = mid; }
                intA = high; document.getElementById('res-nom').innerText = (intA * 100).toFixed(2) + " %";
            } else if (modo === 'cuota') {
                const n = anMax * 12, r = intA / 12, factor = Math.pow(1 + r, n);
                const den = (mom === 'inicio') ? ((factor - 1) / r) * (1 + r) : (factor - 1) / r;
                ap = (obj - (cap * factor)) / den; document.getElementById('res-nom').innerText = Math.max(0, ap).toLocaleString('es-ES', {style: 'currency', currency: 'EUR'});
            }

            let bal = cap, tAp = cap, labels = [], dN = [], dR = [], dI = [];
            const tb = document.getElementById('cuerpo-tabla'); tb.innerHTML = "";
            
            // L√≠mite de 100 a√±os para evitar cuelgues
            const mesesTotales = Math.min(1200, (modo === 'tiempo' ? 1200 : anMax*12));

            for(let m=1; m <= mesesTotales; m++) {
                bal = (mom === 'inicio') ? (bal + ap) * (1 + intA/12) : (bal * (1 + intA/12)) + ap;
                tAp += ap; 
                if (m % 12 === 0 || m === mesesTotales) {
                    let a = m/12, bNeto = bal - (useTax ? calcularIRPF(bal - tAp) : 0);
                    let bReal = bNeto / Math.pow(1 + infla, a);
                    labels.push("A√±o "+a.toFixed(0)); dN.push(bNeto.toFixed(2)); dR.push(bReal.toFixed(2)); dI.push(tAp.toFixed(2));
                    tb.innerHTML += `<tr><td>${a.toFixed(0)}</td><td>${Math.round(tAp).toLocaleString()}‚Ç¨</td><td>${Math.round(bNeto).toLocaleString()}‚Ç¨</td><td style="color:var(--pink); font-weight:bold;">${Math.round(bReal).toLocaleString()}‚Ç¨</td></tr>`;
                    if (modo === 'tiempo' && bNeto >= obj) { document.getElementById('res-nom').innerText = a.toFixed(1) + " a√±os"; break; }
                }
            }
            if (modo === 'ahorro') document.getElementById('res-nom').innerText = (bal).toLocaleString('es-ES', {style: 'currency', currency: 'EUR'});
            document.getElementById('res-real').innerText = (dN[dN.length-1] / Math.pow(1 + infla, dN.length)).toLocaleString('es-ES', {style: 'currency', currency: 'EUR'});
            actualizarGrafico(labels, dN, dR, dI);
        }

        function actualizarGrafico(l, n, r, i) {
            const ctx = document.getElementById('miGrafico').getContext('2d');
            if (grafico) grafico.destroy();
            
            // Crear degradado ne√≥n
            let gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(0, 255, 204, 0.4)');
            gradient.addColorStop(1, 'rgba(0, 255, 204, 0.0)');

            grafico = new Chart(ctx, {
                type: 'line',
                data: { labels: l, datasets: [
                    { label: 'Valor Neto', data: n, borderColor: '#00ffcc', backgroundColor: gradient, fill: true, tension: 0.3, pointBackgroundColor: '#00ffcc' },
                    { label: 'Poder Real', data: r, borderColor: '#ff00ff', borderDash: [5, 5], fill: false, tension: 0.3, pointBackgroundColor: '#ff00ff' },
                    { label: 'Aportado', data: i, borderColor: '#0099ff', borderDash: [2, 2], fill: false, tension: 0.3, pointBackgroundColor: '#0099ff' }
                ]},
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: '#1e293b',
                            titleColor: '#00ffcc',
                            bodyColor: '#f8fafc',
                            borderColor: '#334155',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.parsed.y !== null) label += new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' }).format(context.parsed.y);
                                    return label;
                                }
                            }
                        }
                    }, 
                    scales: { 
                        y: { grid: { color: '#334155' }, ticks: { color: '#94a3b8', callback: function(value) { return value.toLocaleString() + '‚Ç¨'; } } }, 
                        x: { grid: { display: false }, ticks: { color: '#94a3b8', maxRotation: 0 } } 
                    },
                    interaction: { mode: 'nearest', axis: 'x', intersect: false }
                }
            });
        }
        
        // Inicializaci√≥n corregida de visibilidad de campos
        document.getElementById('div-capital').id = 'div-capital'; // Asegurar ID
        cambiarModo(); 
        ejecutarCalculo();
    </script>
</body>
</html>
